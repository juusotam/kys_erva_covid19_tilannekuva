---
title: "COVID-19 KYS ERVA"
date: "`r Sys.Date()`"
output:
  word_document:
    reference_docx: reference.docx
---

```{r setup, include=FALSE, warning = FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)

#file.list <- list.files(path = "./data", pattern = "*ajo.csv")
#tbl <- lapply(read_csv2(paste0("data/", file.list)))
tbl <- list.files(path = "./data", pattern = "*ajo.csv") %>% 
  paste0("data/", .) %>% 
  map_df(~read_csv2(.)) %>% 
  filter(!site_id == "null")

colnames(tbl) <- c("site.id",
                   "package.id",
                   "package.name",
                   "package.status",
                   "start.date",
                   "deadline",
                   "estimated.completion",
                   "completed",
                   "work.amount.est",
                   "work.amount.realization",
                   "tilannekuva",
                   "covid19.tehohoito.ja.tehovalvonta",
                   "covid19.vuodeosasto",
                   "kaikki.potilaat.tehohoito.ja.tehovalvonta",
                   "kaikki.potilaat.vuodeosasto",
                   "potilaita.teholle.covid19",
                   "potilaita.teholle.non.covid19",
                   "covid19.kuolleet",
                   "puutteet.muut.tarvikkeet",
                   "puutteet.muut.laakkeet",
                   "muut.huomiot",
                   "toiminnalliset.muutokset",
                   "pvm",
                   "covid19.potilaat.yhteensa",
                   "covid19.kotiutuneet",
                   "sairaansijat",
                   "tehohoito.ja.tehovaltonta.paikat",
                   "tietotekniset.hairiot",
                   "uudet.positiiviset.covid19.testit",
                   "vaje.antibiooteista",
                   "vaje.infuusioliuokset",
                   "vaje.kipulaakkeista",
                   "vaje.kasidesista",
                   "vaje.hapesta",
                   "vaje.maskeista",
                   "vaje.muut.kriittiset.laakkeet",
                   "vaje.muut.kriittiset.tarvikkeet",
                   "vaje.sedatiivat",
                   "vaje.suojakasineet",
                   "vaje.suojatakeista",
                   "vaje.verenkierrontuki",
                   "vaje.verituotteet",
                   "vaje.visiirit",
                   "vaje.hoitohenkilokunta",
                   "vaje.laakarit",
                   "vaje.muu.henkilokunta",
                   "lisatiedot")

tbl <- tbl %>% 
  mutate(pvm = as.Date(pvm, format = "%d.%m.%Y")) %>% 
  mutate(site.id = case_when(site.id == "4531569" ~ "KYS",
                             site.id == "4531565" ~ "SiunSote",
                             site.id == "4531567" ~ "Sosteri",
                             site.id == "4531583" ~ "ESSOTE",
                             site.id == "4531577" ~ "KSSHP",
                             TRUE ~ site.id)) %>% 
  select(pvm, site.id, 
         sairaansijat, 
         kaikki.potilaat.vuodeosasto, 
         tehohoito.ja.tehovaltonta.paikat, 
         kaikki.potilaat.tehohoito.ja.tehovalvonta,
         covid19.kotiutuneet,
         uudet.positiiviset.covid19.testit, 
         covid19.kuolleet, 
         potilaita.teholle.covid19,
         potilaita.teholle.non.covid19, 
         covid19.potilaat.yhteensa, 
         covid19.vuodeosasto,
         covid19.tehohoito.ja.tehovalvonta,
         vaje.laakarit, vaje.hoitohenkilokunta, vaje.muu.henkilokunta,
         vaje.suojatakeista, vaje.visiirit,
         vaje.maskeista, vaje.suojakasineet, vaje.kasidesista,
         vaje.muut.kriittiset.tarvikkeet, 
         tietotekniset.hairiot,
         puutteet.muut.tarvikkeet,
         vaje.infuusioliuokset, vaje.verituotteet, vaje.hapesta, vaje.kipulaakkeista,
         vaje.sedatiivat, vaje.verenkierrontuki,vaje.antibiooteista, vaje.muut.kriittiset.laakkeet,
         puutteet.muut.laakkeet, toiminnalliset.muutokset,
         muut.huomiot) %>% 
  filter(!is.na(pvm)) %>% 
  mutate(vaje.laakarit = ifelse(vaje.laakarit == 1, "Kyllä", "Ei"),
         vaje.hoitohenkilokunta = ifelse(vaje.hoitohenkilokunta == 1, "Kyllä", "Ei"),
         vaje.muu.henkilokunta = ifelse(vaje.muu.henkilokunta == 1, "Kyllä", "Ei"),
         vaje.maskeista = ifelse(vaje.maskeista == 1, "Kyllä", "Ei"),
         vaje.visiirit = ifelse(vaje.visiirit == 1, "Kyllä", "Ei"),
         vaje.suojakasineet = ifelse(vaje.suojakasineet == 1, "Kyllä", "Ei"),
         vaje.kasidesista = ifelse(vaje.kasidesista == 1, "Kyllä", "Ei"),
         vaje.muut.kriittiset.tarvikkeet = ifelse(vaje.muut.kriittiset.tarvikkeet == 1, "Kyllä", "Ei"),
         vaje.infuusioliuokset = ifelse(vaje.infuusioliuokset == 1, "Kyllä", "Ei"),
         vaje.verituotteet = ifelse(vaje.verituotteet == 1, "Kyllä", "Ei"),
         vaje.hapesta = ifelse(vaje.hapesta == 1, "Kyllä", "Ei"),
         vaje.kipulaakkeista = ifelse(vaje.kipulaakkeista == 1, "Kyllä", "Ei"),
         vaje.sedatiivat = ifelse(vaje.sedatiivat == 1, "Kyllä", "Ei"),
         vaje.verenkierrontuki = ifelse(vaje.verenkierrontuki == 1, "Kyllä", "Ei"),
         vaje.antibiooteista = ifelse(vaje.antibiooteista == 1, "Kyllä", "Ei"),
         vaje.muut.kriittiset.laakkeet = ifelse(vaje.muut.kriittiset.laakkeet == 1, "Kyllä", "Ei"),
         puutteet.muut.laakkeet = ifelse(!is.na(puutteet.muut.laakkeet), puutteet.muut.laakkeet, ""),
         puutteet.muut.tarvikkeet = ifelse(!is.na(puutteet.muut.tarvikkeet), puutteet.muut.tarvikkeet, ""),
         vaje.suojatakeista = ifelse(vaje.suojatakeista == 1, "Kyllä", "Ei"),
         tietotekniset.hairiot = ifelse(tietotekniset.hairiot == 1, "Kyllä", "Ei")) %>% 
  filter(pvm == Sys.Date())

d <- tbl %>% 
  select(-muut.huomiot, -toiminnalliset.muutokset, -pvm) %>% 
  t()
colnames(d) <- as.character(d[1,])
d <- data.frame(d) %>% 
  select(ESSOTE, KSSHP, KYS, SiunSote, Sosteri)
rownames(d) <- c("Sairaanhoitopiiri",
                 "Sairaansijat",
                 "Kaikki potilaat vuodeosastopaikoilla",
                 "Tehohoito ja tehovalvonta paikat",
                 "Kaikki potilaat tehohoito ja tehovalvonta paikoilla",
                 "Kotiutuneet COVID-19 potilaat",
                 "Uudet positiiviset COVID-19 testit",
                 "Kuolleet COVID-19 potilaat",
                 "Kuinka monta COVID-19 potilasta voitaisiin ottaa tehohoitoon nyt",
                 "Kuinka monta EI COVID-19 potilasta voitaisiin ottaa tehohoitoon nyt",
                 "Sairaalahoidossa olevat COVID-19 potilaat yhteensä",
                 "COVID-19 potilaita vuodeosastohoidossa",
                 "COVID-19 potilaite tehohoidossa ja tehovalvontahoidossa",
                 "Vajetta lääkäreistä",
                 "Vajetta hoitajista",
                 "Vajetta muusta henkilökunnasta",
                 "Vaje suojatakeista",
                 "Vaje visiireistä",
                 "Vaje maskeista",
                 "Vaje suojakäsineistä",
                 "Vaje käsidesistä",
                 "Vaje muista kriittisistä tarvikkeista",
                 "Tietotekniikan aiheuttamia toiminnan häiriöitä",
                 "Mistä kriittisistä tarvikkeista",
                 "Vaje infuusioliuoksista",
                 "Vaje verituotteista",
                 "Vaje lääkinnällisestä hapesta",
                 "Vaje kipulääkkeistä",
                 "Vaje sedatiivoista",
                 "Vaje verenkierron tukilääkkeistä",
                 "Vaje antibiooteista",
                 "Vaje muista kriittisistä lääkkeistä",
                 "Mistä kriittisistä lääkkeistä"
                 )


```

`NA` tarkoittaa, että tietoa ei ole syötetty lomakkeelle.

```{r echo = FALSE}
knitr::kable(d[-1, ])
```

```{=openxml}
<w:p><w:r><w:br w:type="page"/></w:r></w:p>
```


## Toiminnalliset muutokset

```{r echo = FALSE}
e <- tbl %>%
  select(site.id, toiminnalliset.muutokset)
colnames(e) <- c("SHP", "Huomio")
knitr::kable(e)
```

## Muut huomiot

```{r echo = FALSE}
f <- tbl %>% 
  select(site.id, muut.huomiot)
colnames(f) <- c("SHP", "Huomio")
knitr::kable(f)
```

